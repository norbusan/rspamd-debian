#!/bin/sh

set -eu

case "$1" in
    configure)
      SERVER_HOME=/var/lib/rspamd
      SERVER_LOG=/var/log/rspamd
      SERVER_USER=_rspamd

      adduser --quiet \
              --system \
              --group \
              --home $SERVER_HOME \
              --no-create-home \
              --disabled-login \
              --gecos "rspamd spam filtering system" \
              --force-badname \
              $SERVER_USER

      chown $SERVER_USER: $SERVER_HOME $SERVER_LOG

      # Rspamd web interface doesn't support symlinks and directory traversal
      cp --remove-destination /usr/share/javascript/bootstrap/js/bootstrap.min.js /usr/share/rspamd/www/js/lib/bootstrap.min.js
      cp --remove-destination /usr/share/javascript/jquery/jquery.min.js /usr/share/rspamd/www/js/lib/jquery-3.3.1.min.js
      cp --remove-destination /usr/share/javascript/requirejs/require.js /usr/share/rspamd/www/js/lib/require.min.js
    ;;

    abort-*)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#
