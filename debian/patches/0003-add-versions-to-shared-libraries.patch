From: =?utf-8?q?Christian_G=C3=B6ttsche?= <cgzones@googlemail.com>
Date: Tue, 14 Jan 2020 22:02:02 +0100
Subject: add versions to shared libraries

Forwarded: not-needed
---
 contrib/aho-corasick/CMakeLists.txt | 2 ++
 contrib/kann/CMakeLists.txt         | 3 ++-
 contrib/libev/CMakeLists.txt        | 1 +
 contrib/replxx/CMakeLists.txt       | 3 ++-
 src/CMakeLists.txt                  | 4 +++-
 5 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/contrib/aho-corasick/CMakeLists.txt b/contrib/aho-corasick/CMakeLists.txt
index 2c431b5..9fa5033 100644
--- a/contrib/aho-corasick/CMakeLists.txt
+++ b/contrib/aho-corasick/CMakeLists.txt
@@ -11,3 +11,5 @@ ELSE()
 	ADD_LIBRARY(rspamd-actrie STATIC ${AHOCORASICSRC})
 	target_link_libraries(rspamd-actrie glib-2.0)
 ENDIF()
+
+SET_TARGET_PROPERTIES(rspamd-actrie PROPERTIES VERSION "${RSPAMD_VERSION}")
diff --git a/contrib/kann/CMakeLists.txt b/contrib/kann/CMakeLists.txt
index b3a1d54..ab56b0c 100644
--- a/contrib/kann/CMakeLists.txt
+++ b/contrib/kann/CMakeLists.txt
@@ -1,10 +1,11 @@
 SET(LIBKANNSRC	kautodiff.c kann.c)
 
 ADD_LIBRARY(rspamd-kann SHARED ${LIBKANNSRC})
+SET_TARGET_PROPERTIES(rspamd-kann PROPERTIES VERSION "${RSPAMD_VERSION}")
 
 IF(WITH_BLAS)
     MESSAGE(STATUS "Use openblas to accelerate kann")
     TARGET_LINK_LIBRARIES(rspamd-kann ${BLAS_REQUIRED_LIBRARIES})
 ENDIF(WITH_BLAS)
 
-INSTALL(TARGETS rspamd-kann LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+INSTALL(TARGETS rspamd-kann LIBRARY DESTINATION ${RSPAMD_LIBDIR})
diff --git a/contrib/libev/CMakeLists.txt b/contrib/libev/CMakeLists.txt
index 53ab6c3..a3b7cc4 100644
--- a/contrib/libev/CMakeLists.txt
+++ b/contrib/libev/CMakeLists.txt
@@ -59,6 +59,7 @@ CHECK_LIBRARY_EXISTS(m ceil "" HAVE_LIBM)
 CONFIGURE_FILE(config.h.in libev-config.h)
 
 ADD_LIBRARY(rspamd-ev SHARED ${LIBEVSRC})
+SET_TARGET_PROPERTIES(rspamd-ev PROPERTIES VERSION "${RSPAMD_VERSION}")
 include_directories("${CMAKE_CURRENT_BINARY_DIR}")
 ADD_DEFINITIONS("-DEV_CONFIG_H=\"libev-config.h\""
 		-DEV_MULTIPLICITY=1
diff --git a/contrib/replxx/CMakeLists.txt b/contrib/replxx/CMakeLists.txt
index 749e612..d6c8630 100644
--- a/contrib/replxx/CMakeLists.txt
+++ b/contrib/replxx/CMakeLists.txt
@@ -65,6 +65,7 @@ set(
 
 set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)
 add_library(rspamd-replxx SHARED ${REPLXX_SOURCES})
+SET_TARGET_PROPERTIES(rspamd-replxx PROPERTIES VERSION "${RSPAMD_VERSION}")
 
 target_include_directories(
 	rspamd-replxx
@@ -75,4 +76,4 @@ set( TARGETS ${TARGETS} rspamd-replxx )
 target_compile_definitions(rspamd-replxx PRIVATE REPLXX_BUILDING_DLL)
 target_link_libraries(rspamd-replxx "${RSPAMD_REQUIRED_LIBRARIES}")
 
-install( TARGETS ${TARGETS} LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+install( TARGETS ${TARGETS} LIBRARY DESTINATION ${RSPAMD_LIBDIR})
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 9a34d2a..1655d42 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -177,6 +177,8 @@ ELSE()
 			"${RAGEL_ragel_smtp_ip_OUTPUTS}")
 ENDIF()
 
+SET_TARGET_PROPERTIES(rspamd-server PROPERTIES VERSION "${RSPAMD_VERSION}")
+
 TARGET_LINK_LIBRARIES(rspamd-server rspamd-http-parser)
 TARGET_LINK_LIBRARIES(rspamd-server rspamd-fpconv)
 TARGET_LINK_LIBRARIES(rspamd-server rspamd-cdb)
@@ -227,4 +229,4 @@ ENDIF(NOT DEBIAN_BUILD)
 TARGET_LINK_LIBRARIES(rspamd rspamd-server)
 
 INSTALL(TARGETS rspamd RUNTIME DESTINATION bin)
-INSTALL(TARGETS rspamd-server LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+INSTALL(TARGETS rspamd-server LIBRARY DESTINATION ${RSPAMD_LIBDIR})
