From: =?utf-8?q?Christian_G=C3=B6ttsche?= <cgzones@googlemail.com>
Date: Tue, 14 Jan 2020 22:02:02 +0100
Subject: add versions to shared libraries

---
 contrib/aho-corasick/CMakeLists.txt | 2 ++
 contrib/kann/CMakeLists.txt         | 3 ++-
 contrib/libev/CMakeLists.txt        | 3 ++-
 contrib/replxx/CMakeLists.txt       | 3 ++-
 src/CMakeLists.txt                  | 4 +++-
 5 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/contrib/aho-corasick/CMakeLists.txt b/contrib/aho-corasick/CMakeLists.txt
index 93c51a1..e5dbae8 100644
--- a/contrib/aho-corasick/CMakeLists.txt
+++ b/contrib/aho-corasick/CMakeLists.txt
@@ -17,3 +17,5 @@ ELSE()
 	ADD_LIBRARY(rspamd-actrie STATIC ${AHOCORASICSRC})
 	target_link_libraries(rspamd-actrie glib-2.0)
 ENDIF()
+
+SET_TARGET_PROPERTIES(rspamd-actrie PROPERTIES VERSION "${RSPAMD_VERSION}")
diff --git a/contrib/kann/CMakeLists.txt b/contrib/kann/CMakeLists.txt
index 2bf32c9..17bd22a 100644
--- a/contrib/kann/CMakeLists.txt
+++ b/contrib/kann/CMakeLists.txt
@@ -7,10 +7,11 @@ IF(ENABLE_FULL_DEBUG MATCHES "OFF")
 ENDIF()
 
 ADD_LIBRARY(rspamd-kann SHARED ${LIBKANNSRC})
+SET_TARGET_PROPERTIES(rspamd-kann PROPERTIES VERSION "${RSPAMD_VERSION}")
 
 IF(WITH_BLAS)
     MESSAGE(STATUS "Use openblas to accelerate kann")
     TARGET_LINK_LIBRARIES(rspamd-kann ${BLAS_REQUIRED_LIBRARIES})
 ENDIF(WITH_BLAS)
 
-INSTALL(TARGETS rspamd-kann LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+INSTALL(TARGETS rspamd-kann LIBRARY DESTINATION ${RSPAMD_LIBDIR})
diff --git a/contrib/libev/CMakeLists.txt b/contrib/libev/CMakeLists.txt
index e98ff12..631203f 100644
--- a/contrib/libev/CMakeLists.txt
+++ b/contrib/libev/CMakeLists.txt
@@ -56,6 +56,7 @@ ENDIF()
 CONFIGURE_FILE(config.h.in libev-config.h)
 
 ADD_LIBRARY(rspamd-ev SHARED ${LIBEVSRC})
+SET_TARGET_PROPERTIES(rspamd-ev PROPERTIES VERSION "${RSPAMD_VERSION}")
 ADD_DEFINITIONS("-DEV_CONFIG_H=\"${CMAKE_CURRENT_BINARY_DIR}/libev-config.h\""
 		-DEV_MULTIPLICITY=1
 		-DEV_USE_FLOOR=1
@@ -70,4 +71,4 @@ IF(ENABLE_FULL_DEBUG MATCHES "ON")
 	ADD_DEFINITIONS(-DEV_VERIFY=3)
 ENDIF()
 
-INSTALL(TARGETS rspamd-ev LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+INSTALL(TARGETS rspamd-ev LIBRARY DESTINATION ${RSPAMD_LIBDIR})
diff --git a/contrib/replxx/CMakeLists.txt b/contrib/replxx/CMakeLists.txt
index b391639..14b7205 100644
--- a/contrib/replxx/CMakeLists.txt
+++ b/contrib/replxx/CMakeLists.txt
@@ -66,6 +66,7 @@ set(
 
 set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)
 add_library(rspamd-replxx SHARED ${REPLXX_SOURCES})
+SET_TARGET_PROPERTIES(rspamd-replxx PROPERTIES VERSION "${RSPAMD_VERSION}")
 
 target_include_directories(
 	rspamd-replxx
@@ -75,4 +76,4 @@ target_include_directories(
 set( TARGETS ${TARGETS} rspamd-replxx )
 target_compile_definitions(rspamd-replxx PRIVATE REPLXX_BUILDING_DLL)
 
-install( TARGETS ${TARGETS} LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+install( TARGETS ${TARGETS} LIBRARY DESTINATION ${RSPAMD_LIBDIR})
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 4805788..ef2439e 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -178,6 +178,8 @@ ELSE()
 			"${RAGEL_ragel_smtp_ip_OUTPUTS}")
 ENDIF()
 
+SET_TARGET_PROPERTIES(rspamd-server PROPERTIES VERSION "${RSPAMD_VERSION}")
+
 TARGET_LINK_LIBRARIES(rspamd-server rspamd-http-parser)
 TARGET_LINK_LIBRARIES(rspamd-server rspamd-fpconv)
 TARGET_LINK_LIBRARIES(rspamd-server rspamd-cdb)
@@ -228,4 +230,4 @@ ENDIF(NOT DEBIAN_BUILD)
 TARGET_LINK_LIBRARIES(rspamd rspamd-server)
 
 INSTALL(TARGETS rspamd RUNTIME DESTINATION bin)
-INSTALL(TARGETS rspamd-server LIBRARY DESTINATION ${RSPAMD_LIBDIR})
\ No newline at end of file
+INSTALL(TARGETS rspamd-server LIBRARY DESTINATION ${RSPAMD_LIBDIR})
